{"ast":null,"code":"import _regeneratorRuntime from \"/home/sujan/Desktop/disease-predictor/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/sujan/Desktop/disease-predictor/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport jwt_decode from \"jwt-decode\";\nimport authAPI from \"../../api/authAPI\";\nimport setAuthToken from \"../../utils/setAuthToken\";\nlet initialState = {\n  isAuthenticated: false,\n  user: {},\n  errors: {},\n  loading: \"idle\"\n};\nexport const login = createAsyncThunk(\"auth/login\", /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(data, {\n    rejectWithValue\n  }) {\n    var response, token, decoded;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return authAPI.login(data);\n\n        case 3:\n          response = _context.sent;\n          token = response.token; // Set token to local storage\n\n          localStorage.setItem(\"token\", token); // Set token to Auth header\n\n          setAuthToken(token); // Decode token to get user data\n\n          decoded = jwt_decode(token);\n          return _context.abrupt(\"return\", decoded.user);\n\n        case 11:\n          _context.prev = 11;\n          _context.t0 = _context[\"catch\"](0);\n          console.log(\"ERROR: \", _context.t0.data);\n          return _context.abrupt(\"return\", rejectWithValue(_context.t0.data));\n\n        case 15:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee, null, [[0, 11]]);\n  }));\n\n  return function (_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}());\nconst auth = createSlice({\n  name: \"auth\",\n  initialState,\n  reducers: {\n    setCurrentUser: (state, action) => {\n      state.isAuthenticated = true;\n      state.user = action.payload;\n    },\n    authFailed: (state, action) => {\n      state.isAuthenticated = false;\n      state.errors = action.payload;\n    },\n    logoutUser: state => {\n      // Remove token from local storage\n      localStorage.removeItem(\"token\"); // Remove auth header for future requests\n\n      setAuthToken(false); // Set isAuthenticated to false and user to {}\n\n      state.isAuthenticated = false;\n      state.user = {};\n      state.errors = {};\n    },\n    clearErrors: (state, action) => {\n      // Clear errors if there are some in the state\n      if (Object.keys(state.errors).length > 0) {\n        state.errors = {};\n      }\n    }\n  },\n  extraReducers: {\n    [login.pending]: (state, action) => {\n      if (state.loading === \"idle\") {\n        state.loading = \"pending\";\n      }\n    },\n    [login.fulfilled]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.isAuthenticated = true;\n        state.user = action.payload;\n      }\n    },\n    [login.rejected]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.errors = action.payload;\n      }\n    }\n  }\n});\nconst _auth$actions = auth.actions,\n      setCurrentUser = _auth$actions.setCurrentUser,\n      logoutUser = _auth$actions.logoutUser,\n      authFailed = _auth$actions.authFailed,\n      clearErrors = _auth$actions.clearErrors;\nexport { setCurrentUser, logoutUser, authFailed, clearErrors };\nexport default auth.reducer;","map":{"version":3,"sources":["/home/sujan/Desktop/disease-predictor/client/src/features/auth/authSlice.js"],"names":["createSlice","createAsyncThunk","jwt_decode","authAPI","setAuthToken","initialState","isAuthenticated","user","errors","loading","login","data","rejectWithValue","response","token","localStorage","setItem","decoded","console","log","auth","name","reducers","setCurrentUser","state","action","payload","authFailed","logoutUser","removeItem","clearErrors","Object","keys","length","extraReducers","pending","fulfilled","rejected","actions","reducer"],"mappings":";;AAAA,SAASA,WAAT,EAAsBC,gBAAtB,QAA8C,kBAA9C;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,OAAP,MAAoB,mBAApB;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AAEA,IAAIC,YAAY,GAAG;AACjBC,EAAAA,eAAe,EAAE,KADA;AAEjBC,EAAAA,IAAI,EAAE,EAFW;AAGjBC,EAAAA,MAAM,EAAE,EAHS;AAIjBC,EAAAA,OAAO,EAAE;AAJQ,CAAnB;AAOA,OAAO,MAAMC,KAAK,GAAGT,gBAAgB,CACnC,YADmC;AAAA,sEAEnC,iBAAOU,IAAP,EAAa;AAAEC,IAAAA;AAAF,GAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAE2BT,OAAO,CAACO,KAAR,CAAcC,IAAd,CAF3B;;AAAA;AAEUE,UAAAA,QAFV;AAGYC,UAAAA,KAHZ,GAGsBD,QAHtB,CAGYC,KAHZ,EAII;;AACAC,UAAAA,YAAY,CAACC,OAAb,CAAqB,OAArB,EAA8BF,KAA9B,EALJ,CAMI;;AACAV,UAAAA,YAAY,CAACU,KAAD,CAAZ,CAPJ,CAQI;;AACMG,UAAAA,OATV,GASoBf,UAAU,CAACY,KAAD,CAT9B;AAAA,2CAUWG,OAAO,CAACV,IAVnB;;AAAA;AAAA;AAAA;AAYIW,UAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuB,YAAMR,IAA7B;AAZJ,2CAaWC,eAAe,CAAC,YAAMD,IAAP,CAb1B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAFmC;;AAAA;AAAA;AAAA;AAAA,IAA9B;AAsBP,MAAMS,IAAI,GAAGpB,WAAW,CAAC;AACvBqB,EAAAA,IAAI,EAAE,MADiB;AAEvBhB,EAAAA,YAFuB;AAGvBiB,EAAAA,QAAQ,EAAE;AACRC,IAAAA,cAAc,EAAE,CAACC,KAAD,EAAQC,MAAR,KAAmB;AACjCD,MAAAA,KAAK,CAAClB,eAAN,GAAwB,IAAxB;AACAkB,MAAAA,KAAK,CAACjB,IAAN,GAAakB,MAAM,CAACC,OAApB;AACD,KAJO;AAKRC,IAAAA,UAAU,EAAE,CAACH,KAAD,EAAQC,MAAR,KAAmB;AAC7BD,MAAAA,KAAK,CAAClB,eAAN,GAAwB,KAAxB;AACAkB,MAAAA,KAAK,CAAChB,MAAN,GAAeiB,MAAM,CAACC,OAAtB;AACD,KARO;AASRE,IAAAA,UAAU,EAAGJ,KAAD,IAAW;AACrB;AACAT,MAAAA,YAAY,CAACc,UAAb,CAAwB,OAAxB,EAFqB,CAGrB;;AACAzB,MAAAA,YAAY,CAAC,KAAD,CAAZ,CAJqB,CAKrB;;AACAoB,MAAAA,KAAK,CAAClB,eAAN,GAAwB,KAAxB;AACAkB,MAAAA,KAAK,CAACjB,IAAN,GAAa,EAAb;AACAiB,MAAAA,KAAK,CAAChB,MAAN,GAAe,EAAf;AACD,KAlBO;AAmBRsB,IAAAA,WAAW,EAAE,CAACN,KAAD,EAAQC,MAAR,KAAmB;AAC9B;AACA,UAAIM,MAAM,CAACC,IAAP,CAAYR,KAAK,CAAChB,MAAlB,EAA0ByB,MAA1B,GAAmC,CAAvC,EAA0C;AACxCT,QAAAA,KAAK,CAAChB,MAAN,GAAe,EAAf;AACD;AACF;AAxBO,GAHa;AA6BvB0B,EAAAA,aAAa,EAAE;AACb,KAACxB,KAAK,CAACyB,OAAP,GAAiB,CAACX,KAAD,EAAQC,MAAR,KAAmB;AAClC,UAAID,KAAK,CAACf,OAAN,KAAkB,MAAtB,EAA8B;AAC5Be,QAAAA,KAAK,CAACf,OAAN,GAAgB,SAAhB;AACD;AACF,KALY;AAMb,KAACC,KAAK,CAAC0B,SAAP,GAAmB,CAACZ,KAAD,EAAQC,MAAR,KAAmB;AACpC,UAAID,KAAK,CAACf,OAAN,KAAkB,SAAtB,EAAiC;AAC/Be,QAAAA,KAAK,CAACf,OAAN,GAAgB,MAAhB;AACAe,QAAAA,KAAK,CAAClB,eAAN,GAAwB,IAAxB;AACAkB,QAAAA,KAAK,CAACjB,IAAN,GAAakB,MAAM,CAACC,OAApB;AACD;AACF,KAZY;AAab,KAAChB,KAAK,CAAC2B,QAAP,GAAkB,CAACb,KAAD,EAAQC,MAAR,KAAmB;AACnC,UAAID,KAAK,CAACf,OAAN,KAAkB,SAAtB,EAAiC;AAC/Be,QAAAA,KAAK,CAACf,OAAN,GAAgB,MAAhB;AACAe,QAAAA,KAAK,CAAChB,MAAN,GAAeiB,MAAM,CAACC,OAAtB;AACD;AACF;AAlBY;AA7BQ,CAAD,CAAxB;sBAwDIN,IAAI,CAACkB,O;MAJPf,c,iBAAAA,c;MACAK,U,iBAAAA,U;MACAD,U,iBAAAA,U;MACAG,W,iBAAAA,W;;AAEF,eAAeV,IAAI,CAACmB,OAApB","sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport jwt_decode from \"jwt-decode\";\nimport authAPI from \"../../api/authAPI\";\nimport setAuthToken from \"../../utils/setAuthToken\";\n\nlet initialState = {\n  isAuthenticated: false,\n  user: {},\n  errors: {},\n  loading: \"idle\",\n};\n\nexport const login = createAsyncThunk(\n  \"auth/login\",\n  async (data, { rejectWithValue }) => {\n    try {\n      const response = await authAPI.login(data);\n      const { token } = response;\n      // Set token to local storage\n      localStorage.setItem(\"token\", token);\n      // Set token to Auth header\n      setAuthToken(token);\n      // Decode token to get user data\n      const decoded = jwt_decode(token);\n      return decoded.user;\n    } catch (error) {\n      console.log(\"ERROR: \", error.data);\n      return rejectWithValue(error.data);\n    }\n  }\n);\n\n\n\nconst auth = createSlice({\n  name: \"auth\",\n  initialState,\n  reducers: {\n    setCurrentUser: (state, action) => {\n      state.isAuthenticated = true;\n      state.user = action.payload;\n    },\n    authFailed: (state, action) => {\n      state.isAuthenticated = false;\n      state.errors = action.payload;\n    },\n    logoutUser: (state) => {\n      // Remove token from local storage\n      localStorage.removeItem(\"token\");\n      // Remove auth header for future requests\n      setAuthToken(false);\n      // Set isAuthenticated to false and user to {}\n      state.isAuthenticated = false;\n      state.user = {};\n      state.errors = {};\n    },\n    clearErrors: (state, action) => {\n      // Clear errors if there are some in the state\n      if (Object.keys(state.errors).length > 0) {\n        state.errors = {};\n      }\n    },\n  },\n  extraReducers: {\n    [login.pending]: (state, action) => {\n      if (state.loading === \"idle\") {\n        state.loading = \"pending\";\n      }\n    },\n    [login.fulfilled]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.isAuthenticated = true;\n        state.user = action.payload;\n      }\n    },\n    [login.rejected]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.errors = action.payload;\n      }\n    },\n  },\n});\n\nexport const {\n  setCurrentUser,\n  logoutUser,\n  authFailed,\n  clearErrors,\n} = auth.actions;\nexport default auth.reducer;\n"]},"metadata":{},"sourceType":"module"}