{"ast":null,"code":"import _regeneratorRuntime from \"/home/sujan/Desktop/mern-auth-bolierplate/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/sujan/Desktop/mern-auth-bolierplate/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport jwt_decode from \"jwt-decode\";\nimport authAPI from \"api/authAPI\";\nimport setAuthToken from \"utils/setAuthToken\";\nvar initialState = {\n  isAuthenticated: false,\n  user: {},\n  errors: {},\n  loading: \"idle\"\n};\nexport var login = createAsyncThunk(\"auth/login\", /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(data, _ref) {\n    var rejectWithValue, response, token, decoded;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            rejectWithValue = _ref.rejectWithValue;\n            _context.prev = 1;\n            _context.next = 4;\n            return authAPI.login(data);\n\n          case 4:\n            response = _context.sent;\n            token = response.token; // Set token to local storage\n\n            localStorage.setItem(\"token\", token); // Set token to Auth header\n\n            setAuthToken(token); // Decode token to get user data\n\n            decoded = jwt_decode(token);\n            return _context.abrupt(\"return\", decoded.user);\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](1);\n            console.log(\"ERROR: \", _context.t0.data);\n            return _context.abrupt(\"return\", rejectWithValue(_context.t0.data));\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[1, 12]]);\n  }));\n\n  return function (_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nexport var register = createAsyncThunk(\"auth/register\", /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data, _ref3) {\n    var rejectWithValue, response, token, decoded;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            rejectWithValue = _ref3.rejectWithValue;\n            _context2.prev = 1;\n            _context2.next = 4;\n            return authAPI.register(data);\n\n          case 4:\n            response = _context2.sent;\n            token = response.token; // Set token to local storage\n\n            localStorage.setItem(\"token\", token); // Set token to Auth header\n\n            setAuthToken(token); // Decode token to get user data\n\n            decoded = jwt_decode(token);\n            return _context2.abrupt(\"return\", decoded.user);\n\n          case 12:\n            _context2.prev = 12;\n            _context2.t0 = _context2[\"catch\"](1);\n            return _context2.abrupt(\"return\", rejectWithValue(_context2.t0.data));\n\n          case 15:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[1, 12]]);\n  }));\n\n  return function (_x3, _x4) {\n    return _ref4.apply(this, arguments);\n  };\n}());\nvar auth = createSlice({\n  name: \"auth\",\n  initialState: initialState,\n  reducers: {\n    setCurrentUser: function setCurrentUser(state, action) {\n      state.isAuthenticated = true;\n      state.user = action.payload;\n    },\n    authFailed: function authFailed(state, action) {\n      state.isAuthenticated = false;\n      state.errors = action.payload;\n    },\n    logoutUser: function logoutUser(state) {\n      // Remove token from local storage\n      localStorage.removeItem(\"token\"); // Remove auth header for future requests\n\n      setAuthToken(false); // Set isAuthenticated to false and user to {}\n\n      state.isAuthenticated = false;\n      state.user = {};\n      state.errors = {};\n    },\n    clearErrors: function clearErrors(state, action) {\n      // Clear errors if there are some in the state\n      if (Object.keys(state.errors).length > 0) {\n        state.errors = {};\n      }\n    }\n  },\n  extraReducers: {\n    [register.pending]: function (state, action) {\n      if (state.loading === \"idle\") {\n        state.loading = \"pending\";\n      }\n    },\n    [login.pending]: function (state, action) {\n      if (state.loading === \"idle\") {\n        state.loading = \"pending\";\n      }\n    },\n    [register.fulfilled]: function (state, action) {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.isAuthenticated = true;\n        state.user = action.payload;\n      }\n    },\n    [register.rejected]: function (state, action) {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.errors = action.payload;\n      }\n    },\n    [login.fulfilled]: function (state, action) {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.isAuthenticated = true;\n        state.user = action.payload;\n      }\n    },\n    [login.rejected]: function (state, action) {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.errors = action.payload;\n      }\n    }\n  }\n});\nvar _auth$actions = auth.actions,\n    setCurrentUser = _auth$actions.setCurrentUser,\n    logoutUser = _auth$actions.logoutUser,\n    authFailed = _auth$actions.authFailed,\n    clearErrors = _auth$actions.clearErrors;\nexport { setCurrentUser, logoutUser, authFailed, clearErrors };\nexport default auth.reducer;","map":{"version":3,"sources":["/home/sujan/Desktop/mern-auth-bolierplate/client/src/features/auth/authSlice.js"],"names":["createSlice","createAsyncThunk","jwt_decode","authAPI","setAuthToken","initialState","isAuthenticated","user","errors","loading","login","data","rejectWithValue","response","token","localStorage","setItem","decoded","console","log","register","auth","name","reducers","setCurrentUser","state","action","payload","authFailed","logoutUser","removeItem","clearErrors","Object","keys","length","extraReducers","pending","fulfilled","rejected","actions","reducer"],"mappings":"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","sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport jwt_decode from \"jwt-decode\";\nimport authAPI from \"api/authAPI\";\nimport setAuthToken from \"utils/setAuthToken\";\n\nlet initialState = {\n  isAuthenticated: false,\n  user: {},\n  errors: {},\n  loading: \"idle\",\n};\n\nexport const login = createAsyncThunk(\n  \"auth/login\",\n  async (data, { rejectWithValue }) => {\n    try {\n      const response = await authAPI.login(data);\n      const { token } = response;\n      // Set token to local storage\n      localStorage.setItem(\"token\", token);\n      // Set token to Auth header\n      setAuthToken(token);\n      // Decode token to get user data\n      const decoded = jwt_decode(token);\n      return decoded.user;\n    } catch (error) {\n      console.log(\"ERROR: \", error.data);\n      return rejectWithValue(error.data);\n    }\n  }\n);\n\nexport const register = createAsyncThunk(\n  \"auth/register\",\n  async (data, { rejectWithValue }) => {\n    try {\n      const response = await authAPI.register(data);\n      const { token } = response;\n      // Set token to local storage\n      localStorage.setItem(\"token\", token);\n      // Set token to Auth header\n      setAuthToken(token);\n      // Decode token to get user data\n      const decoded = jwt_decode(token);\n      return decoded.user;\n    } catch (error) {\n      return rejectWithValue(error.data);\n    }\n  }\n);\n\nconst auth = createSlice({\n  name: \"auth\",\n  initialState,\n  reducers: {\n    setCurrentUser: (state, action) => {\n      state.isAuthenticated = true;\n      state.user = action.payload;\n    },\n    authFailed: (state, action) => {\n      state.isAuthenticated = false;\n      state.errors = action.payload;\n    },\n    logoutUser: (state) => {\n      // Remove token from local storage\n      localStorage.removeItem(\"token\");\n      // Remove auth header for future requests\n      setAuthToken(false);\n      // Set isAuthenticated to false and user to {}\n      state.isAuthenticated = false;\n      state.user = {};\n      state.errors = {};\n    },\n    clearErrors: (state, action) => {\n      // Clear errors if there are some in the state\n      if (Object.keys(state.errors).length > 0) {\n        state.errors = {};\n      }\n    },\n  },\n  extraReducers: {\n    [register.pending]: (state, action) => {\n      if (state.loading === \"idle\") {\n        state.loading = \"pending\";\n      }\n    },\n    [login.pending]: (state, action) => {\n      if (state.loading === \"idle\") {\n        state.loading = \"pending\";\n      }\n    },\n    [register.fulfilled]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.isAuthenticated = true;\n        state.user = action.payload;\n      }\n    },\n    [register.rejected]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.errors = action.payload;\n      }\n    },\n    [login.fulfilled]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.isAuthenticated = true;\n        state.user = action.payload;\n      }\n    },\n    [login.rejected]: (state, action) => {\n      if (state.loading === \"pending\") {\n        state.loading = \"idle\";\n        state.errors = action.payload;\n      }\n    },\n  },\n});\n\nexport const {\n  setCurrentUser,\n  logoutUser,\n  authFailed,\n  clearErrors,\n} = auth.actions;\nexport default auth.reducer;\n"]},"metadata":{},"sourceType":"module"}